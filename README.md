# Управление локальными пользователями Windows с помощью PowerShell

Этот PowerShell скрипт является универсальным инструментом для массового **создания**, **обновления** и **удаления** локальных пользователей Windows. Он использует один и тот же текстовый файл в качестве источника данных для всех операций, что делает управление группами пользователей быстрым и удобным.

## Возможности

*   **Три режима работы:** Создание, обновление или удаление пользователей с помощью переключателей (`-Update`, `-Delete`).
*   **Чтение структурированных данных:** Работает с файлом формата `Имя<ТАБ>Полное имя<ТАБ>Описание`.
*   **Гибкое обновление:** Позволяет массово менять пароли и описания у существующих пользователей.
*   **Полное удаление:** В режиме удаления скрипт не только удаляет учетную запись, но и корректно находит и стирает папку профиля пользователя.
*   **Информативный вывод:** Подробно сообщает в консоли о статусе каждой операции.

## Требования

*   Windows Server 2016 / 2019 / 2022 или Windows 10 / 11 Pro.
*   PowerShell 5.1 или выше.
*   Скрипт должен запускаться от имени **Администратора**.

## Подготовка

1.  **Сохраните код скрипта в файл с именем `Create-Users.ps1`.**

    Или скачайте последнюю версию напрямую из репозитория:
    ```powershell
    curl https://raw.githubusercontent.com/DIMNISSV/win-create-users/refs/heads/master/Create-Users.ps1 -o Create-Users.ps1
    ```

2.  **Создайте текстовый файл (например, `users.txt`) для списка пользователей.**

3.  **Заполните файл данными в нужном формате.**
    Файл должен быть в кодировке **UTF-8**. Первая строка **обязательно** должна быть строкой заголовков. В качестве пароля используется значение из колонки "Описание".

    **Формат файла:**
    ```
    Имя<ТАБУЛЯЦИЯ>Полное имя<ТАБУЛЯЦИЯ>Описание
    ```

    **Пример содержимого `users.txt`:**
    ```tsv
    Имя	Полное имя	Описание
    Ackarova	Anna Ackarova	!h5*Fp!2kL9@b=3
    Ivanov	Ivan Ivanov	!h5*Fp!2kL9@b=R
    Petrov	Petr Petrov	zX9vC1qWnK4p
    ```

## Разрешение на выполнение скрипта

По умолчанию PowerShell блокирует запуск скриптов. Перед первым использованием выполните в консоли PowerShell (запущенной от имени Администратора) следующую команду, чтобы разрешить выполнение для текущей сессии:

```powershell
Set-ExecutionPolicy RemoteSigned -Scope Process
```

## Использование скрипта

Скрипт запускается из консоли PowerShell и управляется с помощью параметров.

### Параметры

| Параметр              | Описание                                                                                                   | Обязательный | Пример значения                                  |
| --------------------- | ---------------------------------------------------------------------------------------------------------- | -------------- | ------------------------------------------------ |
| `-PathToFile`         | Полный путь к вашему текстовому файлу с пользователями.                                                    | **Да**         | `".\users.txt"`                                  |
| `-Delete`             | **(Переключатель)** Режим удаления пользователей.                                                          | Нет            | `-Delete`                                        |
| `-Update`             | **(Переключатель)** Режим обновления пользователей.                                                        | Нет            | `-Update`                                        |
| `-Groups`             | (Только для создания) Список групп для добавления новых пользователей.                                     | Нет            | `"Remote Desktop Users", "Power Users"`          |
| `-ForcePasswordChange`| (Только для создания) Требовать смену пароля. По умолчанию `$true`.                                        | Нет            | `$false`                                         |

---

### Режим 1: Создание пользователей

Чтобы создать пользователей, запустите скрипт без ключей `-Update` или `-Delete`.

**Пример:**```powershell
.\Create-Users.ps1 -PathToFile .\users.txt -Groups "Remote Desktop Users"
```

### Режим 2: Обновление пользователей

Чтобы обновить существующих пользователей, используйте ключ `-Update`. Скрипт проигнорирует пользователей из файла, которых нет в системе.

**Важно:** При обновлении происходит следующее сопоставление:
*   Новое **Описание** пользователя берется из колонки `"Полное имя"`.
*   Новый **Пароль** пользователя берется из колонки `"Описание"`.

**Пример:**
```powershell
.\Create-Users.ps1 -PathToFile .\users.txt -Update
```

### Режим 3: Удаление пользователей

Чтобы удалить всех пользователей, перечисленных в файле, используйте ключ `-Delete`.

**Пример:**
```powershell
.\Create-Users.ps1 -PathToFile .\users.txt -Delete
```
