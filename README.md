# Управление локальными пользователями Windows с помощью PowerShell

Этот PowerShell скрипт является универсальным инструментом для массового **создания** и **удаления** локальных пользователей Windows. Он использует один и тот же текстовый файл в качестве источника данных для обеих операций, что делает управление группами пользователей быстрым и удобным.

## Возможности

*   **Два режима работы:** Создание или удаление пользователей с помощью одного переключателя (`-Delete`).
*   **Чтение структурированных данных:** Работает с файлом формата `Имя<ТАБ>Полное имя<ТАБ>Описание`.
*   **Полное удаление:** В режиме удаления скрипт не только удаляет учетную запись, но и корректно находит и стирает папку профиля пользователя (`C:\Users\...`).
*   **Гибкое создание:** Позволяет автоматически добавлять новых пользователей в нужные группы и устанавливать требование смены пароля при первом входе.
*   **Информативный вывод:** Подробно сообщает в консоли о статусе каждой операции.

## Требования

*   Windows Server 2016 / 2019 / 2022 или Windows 10 / 11 Pro.
*   PowerShell 5.1 или выше.
*   Скрипт должен запускаться от имени **Администратора**.

## Подготовка

1.  **Сохраните код скрипта в файл с именем `Create-Users.ps1`.**

    Или скачайте последнюю версию напрямую из репозитория:
    ```powershell
    curl https://raw.githubusercontent.com/DIMNISSV/win-create-users/refs/heads/master/Create-Users.ps1 -o Create-Users.ps1
    ```

2.  **Создайте текстовый файл (например, `users.txt`) для списка пользователей.**

3.  **Заполните файл данными в нужном формате.**
    Файл должен быть в кодировке **UTF-8**. Первая строка **обязательно** должна быть строкой заголовков. В качестве пароля используется значение из колонки "Описание".

    **Формат файла:**
    ```
    Имя<ТАБУЛЯЦИЯ>Полное имя<ТАБУЛЯЦИЯ>Описание
    ```

    **Пример содержимого `users.txt`:**
    ```tsv
    Имя	Полное имя	Описание
    Annk	Anna Ackarova	4578%vMy%o7
    Ivanov	Ivan Ivanov	!h5*Fp!2kL9@b=R
    Petrov	Petr Petrov	zX9vC1qWnK4p
    ```

## Разрешение на выполнение скрипта

По умолчанию PowerShell блокирует запуск скриптов. Перед первым использованием выполните в консоли PowerShell (запущенной от имени Администратора) следующую команду, чтобы разрешить выполнение для текущей сессии:

```powershell
Set-ExecutionPolicy RemoteSigned -Scope Process
```

## Использование скрипта

Скрипт запускается из консоли PowerShell и управляется с помощью параметров.

### Параметры

| Параметр              | Описание                                                                                                   | Обязательный | Пример значения                                  |
| --------------------- | ---------------------------------------------------------------------------------------------------------- | -------------- | ------------------------------------------------ |
| `-PathToFile`         | Полный путь к вашему текстовому файлу с пользователями.                                                    | **Да**         | `".\users.txt"`                                  |
| `-Delete`             | **(Переключатель)** Если указан, скрипт переходит в режим удаления.                                         | Нет            | `-Delete`                                        |
| `-Groups`             | (Только для создания) Список групп через запятую, в которые нужно добавить пользователей.                    | Нет            | `"Remote Desktop Users", "Power Users"`          |
| `-ForcePasswordChange`| (Только для создания) Требовать смену пароля. По умолчанию `$true` (требовать).                              | Нет            | `$false`                                         |

---

### Режим 1: Создание пользователей

Чтобы создать пользователей, просто запустите скрипт, указав путь к файлу.

**Пример 1: Создать пользователей и добавить их в группу "Пользователи удаленного рабочего стола".**
```powershell
.\Create-Users.ps1 -PathToFile .\users.txt -Groups "Remote Desktop Users"
```

**Пример 2: Создать пользователей с постоянными паролями (без требования смены).**
```powershell
.\Create-Users.ps1 -PathToFile .\users.txt -ForcePasswordChange:$false
```

**Пример 3: Создать пользователей и добавить их в несколько групп.**
```powershell
.\Create-Users.ps1 -PathToFile .\users.txt -Groups "Remote Desktop Users", "Hyper-V Administrators"
```

### Режим 2: Удаление пользователей

Чтобы удалить всех пользователей, перечисленных в файле, запустите скрипт с тем же файлом, но добавьте ключ `-Delete`.

**Пример 4: Полностью удалить всех пользователей из файла `users.txt`.**
Скрипт найдет каждого пользователя по значению из колонки "Имя" и удалит его учетную запись вместе с профилем.
```powershell
.\Create-Users.ps1 -PathToFile .\users.txt -Delete
```
